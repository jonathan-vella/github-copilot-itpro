#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Markdown validation pre-commit hook
echo "Running markdown validation..."

# Get list of staged markdown files
STAGED_MD_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.md$')

if [ -n "$STAGED_MD_FILES" ]; then
  echo "Validating $(echo "$STAGED_MD_FILES" | wc -l) markdown file(s)..."
  
  # Run markdownlint on staged files only
  echo "$STAGED_MD_FILES" | xargs markdownlint --config .markdownlint.json
  
  if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Markdown validation failed!"
    echo "Run 'markdownlint --fix' to auto-fix issues, or fix manually."
    exit 1
  fi
  
  echo "✓ All markdown files passed validation"
else
  echo "No markdown files to validate"
fi
